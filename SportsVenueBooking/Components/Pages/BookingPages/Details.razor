@page "/bookings/details"
@using Microsoft.EntityFrameworkCore
@using SportsVenueBooking.Domain
@inject IDbContextFactory<SportsVenueBooking.Data.SportsVenueBookingContext> DbFactory
@inject NavigationManager NavigationManager

<PageTitle>Booking Details</PageTitle>

<h1>Booking Details</h1>
<hr />

@if (booking is null)
{
    <p><em>Loading...</em></p>
}
else
{
    <dl class="row">
        <dt class="col-sm-3">Venue:</dt>
        <dd class="col-sm-9">@VenueName</dd>

        <dt class="col-sm-2">Booking Date:</dt>
        <dd class="col-sm-10">@booking.BookingDate.ToString("dddd, MMMM dd, yyyy")</dd>

        <dt class="col-sm-2">Start Time:</dt>
        <dd class="col-sm-10">@booking.StartTime.ToString("hh:mm tt")</dd>

        <dt class="col-sm-2">End Time:</dt>
        <dd class="col-sm-10">@booking.EndTime.ToString("hh:mm tt")</dd>

        <dt class="col-sm-2">Status</dt>
        <dd class="col-sm-10">
            @if (booking.Status == "Confirmed")
            {
                <span class="badge bg-success">@booking.Status</span>
            }
            else
            {
                <span class="badge bg-danger">@booking.Status</span>
            }
        </dd>

        @if (!string.IsNullOrEmpty(booking.SpecialRequests))
        {
            <dt class="col-sm-2">Special Requests</dt>
            <dd class="col-sm-10">@booking.SpecialRequests</dd>
        }
    </dl>
    <div>
        @if (booking.Status == "Confirmed")
        {
            <a href="@($"/bookings/edit?id={booking.Id}")" class="btn btn-warning">Edit</a>
        }
        <a href="/bookings" class="btn btn-secondary">Back to List</a>
    </div>
    }

@code {
    private Booking? booking;
    private string? VenueName;

    [SupplyParameterFromQuery]
    private int Id { get; set; }

    protected override async Task OnInitializedAsync()
    {
        using var context = DbFactory.CreateDbContext();
        booking = await context.Booking.FirstOrDefaultAsync(m => m.Id == Id);

        if (booking is null)
        {
            NavigationManager.NavigateTo("notfound");
            return;
        }

        // Get venue name
        var venue = await context.Venue.FirstOrDefaultAsync(v => v.Id == booking.VenueID);
        VenueName = venue?.VenueName ?? "Unknown Venue";
    }
}